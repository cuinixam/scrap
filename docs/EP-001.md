# EP-001: Multi-version App Manifests

- **Status**: Draft
- **Created**: 2026-02-12

## Abstract

One main use case for POKS is to define and download tools with specific versions which are required by a project. In contrast to system package managers (e.g., Scoop) which often focus on the latest version, POKS is not meant to install and update apps to the latest version automatically.

With POKS, a user might define that they need an app with version `1.2.3` in one project and `3.4.5` in another. POKS will download them, and the user can check where each version is installed and use it in their project.

This means that an app manifest shall describe how to get **ANY** available version of an app and not only the latest one.

## Motivation

Current or typical manifest designs often prioritize the latest version. However, for reproducible builds in embedded development and other fields, pinning specific versions of tools is critical. POKS must support a manifest format that allows multiple versions to coexist and be retrievable deterministically.

## Specification

The app manifest JSON structure will be updated to include a `versions` list. Each item in this list describes a specific version of the application.

### JSON Structure

```json
{
    "description": "Zephyr SDK Bundle",
    "license": "Apache-2.0",
    "versions" : [
        {
            "version": "1.0.0",
            "url": "https://github.com/zephyrproject-rtos/sdk-ng/releases/download/v${version}/zephyr-sdk-${version}_${os}-${arch}${ext}",
            "archives": [
                {
                    "os": "windows",
                    "arch": "x86_64",
                    "ext": ".7z",
                    "sha256": "..."
                },
                {
                    "os": "linux",
                    "arch": "x86_64",
                    "url": "https://custom-mirror.com/zephyr-sdk-linux.tar.xz",
                    "sha256": "..."
                },
                {
                    "os": "macos",
                    "arch": "aarch64",
                    "ext": ".tar.xz",
                    "sha256": "..."
                }
            ],
            "bin": [
                "bin",
                "cmake/bin"
            ]
        },
        {
            "version": "0.16.5-1",
            "license": "MIT",
            "url": "https://github.com/zephyrproject-rtos/sdk-ng/releases/download/v${version}/zephyr-sdk-${version}_${os}-${arch}${ext}",
            "archives": [
                {
                    "os": "windows",
                    "arch": "x86_64",
                    "ext": ".7z",
                    "sha256": "..."
                },
                {
                    "os": "linux",
                    "arch": "x86_64",
                    "ext": ".tar.xz",
                    "sha256": "..."
                },
                {
                    "os": "macos",
                    "arch": "aarch64",
                    "ext": ".tar.xz",
                    "sha256": "..."
                }
            ],
            "env": {
                "ZEPHYR_SDK_INSTALL_DIR": "${dir}"
            }
        }
    ]
}
```

### Design Rationale

**1. No Default URLs**:

One cannot define defaults for `url` at the top level. This is considered too fragile. If the URL structure changes (e.g., for the latest version), relying on a default could break older versions that use a different structure. By requiring explicit URL definitions per version (or per archive within a version), we ensure that each version's retrieval method is stable and independent.

**2. No Default Version**:

Poks will **not** support installing a default version if none is specified. Users must always explicitly define the version they intend to install (e.g., `poks install app@1.2.3`). This enforces determinism and prevents accidental upgrades or downgrades.

**3. Inheritance**:

Top-level fields such as `license`, `homepage`, and `description` serve as defaults for all versions. Individual version entries can override these fields if necessary (e.g., if the license changed between versions).

**4. Deprecation / Yanking**:

To handle versions that should no longer be used (e.g., due to critical bugs or security issues), a version entry can include a `yanked` field with a string reason.

- If a user attempts to install a yanked version, Poks will **fail** the installation and display the reason.
- This allows manifest maintainers to "remove" versions effective immediately while preserving the history of why a version is unavailable.

Example:

```json
{
    "version": "1.0.0",
    "yanked": "Critical security vulnerability CVE-2024-XXXX. Upgrade to 1.0.1 immediately.",
    ...
}
```

### Proposed Schema

The `PoksManifest` structure will be updated to reflect the new hierarchy, leveraging `mashumaro` and existing domain models.

```python
@dataclass
class PoksAppVersion(PoksJsonMixin):
    version: str
    archives: list[PoksArchive]
    bin: list[str] | None = None
    env: dict[str, str] | None = None
    license: str | None = None
    yanked: str | None = None  # Reason string if yanked

@dataclass
class PoksManifest(PoksJsonMixin):
    description: str
    versions: list[PoksAppVersion]
    schema_version: str = "1.0.0"
    license: str | None = None
    homepage: str | None = None
```

### Backwards Compatibility

This proposal introduces breaking changes to the manifest format. Existing manifests will need to be migrated to the new structure.
